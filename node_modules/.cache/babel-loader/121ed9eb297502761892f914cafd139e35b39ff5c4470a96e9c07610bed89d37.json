{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Didi\\\\login-react\\\\src\\\\auth\\\\AuthContext.js\",\n  _s = $RefreshSig$();\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport function AuthProvider({\n  children\n}) {\n  _s();\n  const [user, setUser] = useState(null);\n  const [userData, setUserData] = useState(null); // Datos adicionales del usuario\n  const [loading, setLoading] = useState(true);\n\n  // Función para obtener datos del usuario\n  const fetchUserData = async uid => {\n    try {\n      const userDoc = await getDoc(doc(db, 'users', uid));\n      return userDoc.exists() ? userDoc.data() : null;\n    } catch (error) {\n      console.error(\"Error fetching user data:\", error);\n      return null;\n    }\n  };\n\n  // Función de registro modificada\n  const register = async (email, password, userData) => {\n    try {\n      const userCredential = await createUserWithEmailAndPassword(auth, email, password);\n      await setDoc(doc(db, 'users', userCredential.user.uid), {\n        email: email,\n        firstName: userData.firstName,\n        lastName: userData.lastName,\n        role: userData.role || 'user',\n        createdAt: new Date().toISOString()\n      });\n      const additionalData = await fetchUserData(userCredential.user.uid);\n      return {\n        success: true,\n        user: {\n          ...userCredential.user,\n          role: (additionalData === null || additionalData === void 0 ? void 0 : additionalData.role) || 'user'\n        },\n        userData: additionalData\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: error.message\n      };\n    }\n  };\n\n  // Observer de autenticación\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, async currentUser => {\n      if (currentUser) {\n        const additionalData = await fetchUserData(currentUser.uid);\n        setUser({\n          ...currentUser,\n          role: (additionalData === null || additionalData === void 0 ? void 0 : additionalData.role) || 'user'\n        });\n        setUserData(additionalData); // Almacena todos los datos del usuario\n      } else {\n        setUser(null);\n        setUserData(null);\n      }\n      setLoading(false);\n    });\n    return () => unsubscribe();\n  }, []);\n  const value = {\n    user,\n    userData,\n    // Asegúrate de incluir userData en el value\n    loading,\n    login,\n    logout,\n    register,\n    isAuthenticated: !!user,\n    isAdmin: (user === null || user === void 0 ? void 0 : user.role) === 'admin'\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: value,\n    children: !loading && children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 76,\n    columnNumber: 5\n  }, this);\n}\n_s(AuthProvider, \"4Lvrj5jq4weTYzI57B4yrS0C4B0=\");\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["AuthProvider","children","_s","user","setUser","useState","userData","setUserData","loading","setLoading","fetchUserData","uid","userDoc","getDoc","doc","db","exists","data","error","console","register","email","password","userCredential","createUserWithEmailAndPassword","auth","setDoc","firstName","lastName","role","createdAt","Date","toISOString","additionalData","success","message","useEffect","unsubscribe","onAuthStateChanged","currentUser","value","login","logout","isAuthenticated","isAdmin","_jsxDEV","AuthContext","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/Didi/login-react/src/auth/AuthContext.js"],"sourcesContent":["export function AuthProvider({ children }) {\r\n  const [user, setUser] = useState(null);\r\n  const [userData, setUserData] = useState(null); // Datos adicionales del usuario\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // Función para obtener datos del usuario\r\n  const fetchUserData = async (uid) => {\r\n    try {\r\n      const userDoc = await getDoc(doc(db, 'users', uid));\r\n      return userDoc.exists() ? userDoc.data() : null;\r\n    } catch (error) {\r\n      console.error(\"Error fetching user data:\", error);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  // Función de registro modificada\r\n  const register = async (email, password, userData) => {\r\n    try {\r\n      const userCredential = await createUserWithEmailAndPassword(auth, email, password);\r\n      \r\n      await setDoc(doc(db, 'users', userCredential.user.uid), {\r\n        email: email,\r\n        firstName: userData.firstName,\r\n        lastName: userData.lastName,\r\n        role: userData.role || 'user',\r\n        createdAt: new Date().toISOString()\r\n      });\r\n\r\n      const additionalData = await fetchUserData(userCredential.user.uid);\r\n      \r\n      return { \r\n        success: true, \r\n        user: {\r\n          ...userCredential.user,\r\n          role: additionalData?.role || 'user'\r\n        },\r\n        userData: additionalData\r\n      };\r\n    } catch (error) {\r\n      return { success: false, error: error.message };\r\n    }\r\n  };\r\n\r\n  // Observer de autenticación\r\n  useEffect(() => {\r\n    const unsubscribe = onAuthStateChanged(auth, async (currentUser) => {\r\n      if (currentUser) {\r\n        const additionalData = await fetchUserData(currentUser.uid);\r\n        setUser({\r\n          ...currentUser,\r\n          role: additionalData?.role || 'user'\r\n        });\r\n        setUserData(additionalData); // Almacena todos los datos del usuario\r\n      } else {\r\n        setUser(null);\r\n        setUserData(null);\r\n      }\r\n      setLoading(false);\r\n    });\r\n    return () => unsubscribe();\r\n  }, []);\r\n\r\n  const value = {\r\n    user,\r\n    userData, // Asegúrate de incluir userData en el value\r\n    loading,\r\n    login,\r\n    logout,\r\n    register,\r\n    isAuthenticated: !!user,\r\n    isAdmin: user?.role === 'admin'\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={value}>\r\n      {!loading && children}\r\n    </AuthContext.Provider>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}